// torth.torth - Self hosted implementation of the Torth compiler
include "std"
include "compiler/asm"
include "compiler/compile"
include "compiler/error"
include "compiler/lex"
include "compiler/program"

function main :

  // Get the code file from command line (first argument)
  1 get_nth_cmd_line_argument

  // Read the code file
  read_file peek code in

  // Get Functions from code
  get_functions peek functions in

  // Get the intermediate representation (Program) of each Function
  get_sub_programs peek sub_programs in

  // TODO: Type check the Program
  // program type_check_program

  // Generate assembly code from the intermediate representation
  generate_assembly_code take assembly_code in

  // Write the assembly code to a file
  assembly_code mode_644 "test.asm" write_file drop

  // Compile the assembly code file to a Linux x86_64 executable
  compile_executable
end
